from datetime import date

from config.database import SessionLocal, engine
from models.database import Base, Department, Forecast, ForecastSnapshot, Project

# Create tables
Base.metadata.create_all(bind=engine)


def init_database():
    db = SessionLocal()
    try:
        # Check if data already exists
        if db.query(Department).count() > 0:
            print("Database already initialized")
            return

        # Add departments
        departments = [
            Department(id=1, name="Teknologi", code="TEK"),
            Department(id=2, name="Markedsføring", code="MAR"),
            Department(id=3, name="Salg", code="SAL"),
            Department(id=4, name="Drift", code="DRI"),
            Department(id=5, name="Økonomi", code="ØKO"),
        ]
        db.add_all(departments)
        db.commit()

        # Add projects
        projects = [
            Project(id=1, name="Skymigrering", code="P001", department_id=1),
            Project(id=2, name="Mobilapputvikling", code="P002", department_id=1),
            Project(id=3, name="Digital Kampanje K1", code="P003", department_id=2),
            Project(id=4, name="Merkevarefornyelse", code="P004", department_id=2),
            Project(id=5, name="Bedriftssalgsinitiativ", code="P005", department_id=3),
            Project(id=6, name="CRM-implementering", code="P006", department_id=3),
            Project(id=7, name="Prosessautomatisering", code="P007", department_id=4),
            Project(id=8, name="Optimalisering av Forsyningskjede", code="P008", department_id=4),
            Project(id=9, name="Oppgradering av Økonomisystem", code="P009", department_id=5),
            Project(id=10, name="Revisjonsetterlevelse", code="P010", department_id=5),
        ]
        db.add_all(projects)
        db.commit()

        # Add forecasts with detailed monthly data
        forecasts = [
            Forecast(
                id=1,
                department_id=1,
                project_id=1,
                project_name="Cloud Migration Phase 1",
                profit_center="PC-TEK-001",
                wbs="WBS-CM-2026",
                account="6100-IT-INFRA",
                jan=350000,
                feb=380000,
                mar=420000,
                apr=450000,
                may=390000,
                jun=410000,
                jul=400000,
                aug=370000,
                sep=390000,
                oct=420000,
                nov=440000,
                dec=480000,
                total=4900000,
                yearly_sum=4900000,
                amount=4900000,
                time_period="2026",
                period_type="monthly",
                description="Cloud infrastructure migration and optimization",
                created_by="Ola Nordmann",
                created_at=date(2025, 1, 15),
                updated_at=date(2025, 1, 15),
            ),
            Forecast(
                id=2,
                department_id=1,
                project_id=2,
                project_name="Mobile App Development",
                profit_center="PC-TEK-002",
                wbs="WBS-MAD-2026",
                account="6100-IT-DEV",
                jan=220000,
                feb=240000,
                mar=260000,
                apr=250000,
                may=230000,
                jun=240000,
                jul=250000,
                aug=260000,
                sep=270000,
                oct=280000,
                nov=270000,
                dec=290000,
                total=3060000,
                yearly_sum=3060000,
                amount=3060000,
                time_period="2026",
                period_type="monthly",
                description="Mobile application development team",
                created_by="Ola Nordmann",
                created_at=date(2025, 1, 16),
                updated_at=date(2025, 1, 16),
            ),
            Forecast(
                id=3,
                department_id=2,
                project_id=3,
                project_name="Digital Campaign Q1-Q2",
                profit_center="PC-MAR-001",
                wbs="WBS-DC-2026",
                account="6200-MKT-DIGITAL",
                jan=95000,
                feb=105000,
                mar=120000,
                apr=130000,
                may=125000,
                jun=135000,
                jul=90000,
                aug=95000,
                sep=100000,
                oct=110000,
                nov=115000,
                dec=130000,
                total=1350000,
                yearly_sum=1350000,
                amount=1350000,
                time_period="2026",
                period_type="monthly",
                description="Digital advertising and content production",
                created_by="Kari Hansen",
                created_at=date(2025, 1, 18),
                updated_at=date(2025, 1, 18),
            ),
            Forecast(
                id=4,
                department_id=2,
                project_id=4,
                project_name="Brand Refresh Initiative",
                profit_center="PC-MAR-002",
                wbs="WBS-BR-2026",
                account="6200-MKT-BRAND",
                jan=60000,
                feb=65000,
                mar=70000,
                apr=75000,
                may=80000,
                jun=85000,
                jul=75000,
                aug=70000,
                sep=65000,
                oct=70000,
                nov=75000,
                dec=80000,
                total=870000,
                yearly_sum=870000,
                amount=870000,
                time_period="2026",
                period_type="monthly",
                description="Brand agency and materials",
                created_by="Kari Hansen",
                created_at=date(2025, 1, 20),
                updated_at=date(2025, 1, 20),
            ),
            Forecast(
                id=5,
                department_id=3,
                project_id=5,
                project_name="Enterprise Sales Expansion",
                profit_center="PC-SAL-001",
                wbs="WBS-ESE-2026",
                account="6300-SALES-TEAM",
                jan=250000,
                feb=270000,
                mar=280000,
                apr=290000,
                may=280000,
                jun=290000,
                jul=300000,
                aug=310000,
                sep=320000,
                oct=330000,
                nov=340000,
                dec=350000,
                total=3610000,
                yearly_sum=3610000,
                amount=3610000,
                time_period="2026",
                period_type="monthly",
                description="Sales team expansion and training",
                created_by="Per Olsen",
                created_at=date(2025, 1, 22),
                updated_at=date(2025, 1, 22),
            ),
            Forecast(
                id=6,
                department_id=3,
                project_id=6,
                project_name="CRM System Implementation",
                profit_center="PC-SAL-002",
                wbs="WBS-CRM-2026",
                account="6300-SALES-TECH",
                jan=140000,
                feb=150000,
                mar=160000,
                apr=170000,
                may=165000,
                jun=175000,
                jul=160000,
                aug=155000,
                sep=150000,
                oct=145000,
                nov=140000,
                dec=135000,
                total=1845000,
                yearly_sum=1845000,
                amount=1845000,
                time_period="2026",
                period_type="monthly",
                description="CRM software licenses and implementation",
                created_by="Per Olsen",
                created_at=date(2025, 1, 25),
                updated_at=date(2025, 1, 25),
            ),
            Forecast(
                id=7,
                department_id=4,
                project_id=7,
                project_name="Process Automation Suite",
                profit_center="PC-DRI-001",
                wbs="WBS-PA-2026",
                account="6400-OPS-AUTO",
                jan=75000,
                feb=80000,
                mar=85000,
                apr=90000,
                may=88000,
                jun=92000,
                jul=95000,
                aug=93000,
                sep=90000,
                oct=88000,
                nov=85000,
                dec=82000,
                total=1043000,
                yearly_sum=1043000,
                amount=1043000,
                time_period="2026",
                period_type="monthly",
                description="Automation tools and consulting",
                created_by="Ingrid Berg",
                created_at=date(2025, 2, 1),
                updated_at=date(2025, 2, 1),
            ),
            Forecast(
                id=8,
                department_id=4,
                project_id=8,
                project_name="Supply Chain Optimization",
                profit_center="PC-DRI-002",
                wbs="WBS-SCO-2026",
                account="6400-OPS-SUPPLY",
                jan=165000,
                feb=175000,
                mar=185000,
                apr=190000,
                may=195000,
                jun=200000,
                jul=195000,
                aug=190000,
                sep=185000,
                oct=180000,
                nov=175000,
                dec=170000,
                total=2205000,
                yearly_sum=2205000,
                amount=2205000,
                time_period="2026",
                period_type="monthly",
                description="Supply chain software and optimization",
                created_by="Ingrid Berg",
                created_at=date(2025, 2, 3),
                updated_at=date(2025, 2, 3),
            ),
        ]
        db.add_all(forecasts)
        db.commit()

        print("Database initialized successfully with Norwegian data!")

    finally:
        db.close()


if __name__ == "__main__":
    init_database()
